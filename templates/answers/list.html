{% extends "layout.html" %}  {# TODO: remove double quotes from templates #}
{% load answers %}
{% load likes %}
{% load questions_status %}
{% load i18n %}

{% block title %}{% trans "Answers" %}{% endblock title %}
{% block main %}
  {{ block.super }}
  {% include '_countries.html' with url_name='answers:index' %}

  {% if question %}
    {# TODO: Split with sub templates #}
    <div class="m-3">
      <header class="h3">{{ question.truncated_en_text }}</header>
      <span>{{ question.en_text }}</span>

      <hr />

      <a href="{% url 'likes:toggle_subscription' country_id=question.country_id question_id=question.id %}">
        <i class="bi bi-star{% if question|subscribed:request.user %}-fill{% endif %}"></i>
      </a>
      {{ question.country }} <i class="bi bi-coin"></i> {{ question.price }}

      {% if question.status != 'closed' %}
        <span class="text-{{ question|question_status_class }}">
          <i class="bi bi-{{ question|question_status_icon }}"></i>
          {{ question.get_status_display }}
        </span>
      {% endif %}

      {% if question.status in 'answered closed'|split %}
        <i class="bi bi-chat-left"></i>{{ question.answer_set.count }} {% trans 'Answers' %}
      {% endif %}

      <span class="text-secondary">
        {% if question.status in 'approved published answered'|split %}
          {{ question.status_changed|timeuntil }}
        {% else %}
          {{ question.get_status_display }}
        {% endif %}
      </span>

      {% include 'users/_avatar.html' with user=question.author %}
      {{ question.author.username }}
    </div>
    {% if question.status in 'rejected draft'|split and question.reason %}
      <div class="ms-5"><b>{% trans 'Reason' %}:</b> {{ question.reason }}</div>
    {% endif %}
    <hr />
  {% endif %}

  {% for answer in object_list %}
    <div class="d-flex m-3">
      {% include 'answers/_answer.html' with answer=answer %}

      <div class="ms-3">
        <a href="{% url 'answers:detail' pk=answer.id question_id=answer.question_id country_id=answer.question.country_id %}">
          {{ answer.truncated_en_text }}
        </a>
      </div>
    </div>

    {% include 'likes/_for_answer.html' with answer=answer %}

    <hr />
  {% endfor %}

  {% if question.author != request.user and question.status == 'published' and question|is_not_answered_by_me:request.user %}
    <a href="{% url 'answers:create' question_id=question.id country_id=question.country_id %}" class="btn btn-primary">
      {% trans 'Add new answer' %}
    </a>
  {% endif %}
{% endblock main %}
